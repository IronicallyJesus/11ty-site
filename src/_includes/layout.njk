<!doctype html>
<!-- HTML5 -->
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
        <meta name="generator" content="{{ eleventy.generator }}">
        <title>{{ title }}</title>
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="shortcut icon" href="/favicon.ico">
        <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
        <meta name="description" content="{{ description }}">
        <!-- Open Graph Meta Tags -->
        <meta property="og:title" content="{{ title }}">
        <meta property="og:description" content="{{ description }}">
        <meta property="og:type" content="article">
        <meta property="og:url" content="{{ site.url }}{{ page.url }}">
        <meta property="og:image" content="{{ site.url }}{{ image }}">
        <!-- Twitter Card Meta Tags -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:title" content="{{ title }}">
        <meta property="twitter:description" content="{{ description }}">
        <meta property="twitter:image" content="{{ site.url }}{{ image }}">
        <!-- Structured Data (JSON-LD) -->
        {% if date %}
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "BlogPosting",
                "headline": "{{ title }}",
                "description": "{{ description }}",
                "image": "{{ site.url }}{{ image }}",
                "author": {
                    "@type": "Person",
                    "name": "{{ site.author.name }}"
                },
                "datePublished": "{{ date | htmlDateString }}",
                "mainEntityOfPage": {
                    "@type": "WebPage",
                    "@id": "{{ site.url }}{{ page.url }}"
                    }
            }
        </script>
        {% endif %}
        <link rel="preload" href="/assets/fontawesome/css/all.min.css" as="style">
        <link rel="stylesheet" href="/css/style.css?v={{ buildTime }}">
        <link rel="stylesheet" href="/assets/fontawesome/css/all.min.css">
        {% if '/blog/' in page.url %}
        <link rel="stylesheet" href="/css/prism.css">
        {% endif %}
        <link rel="canonical" href="{{ site.url }}{{ page.url }}">
        <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="{{ site.title }} RSS Feed">
        {% if page.url !== "/"  and image %}
        <link rel="preload" as="image" href="{{ image }}">
        {% endif %}
    </head>
    <body class="antialiased selection:bg-accent-primary selection:text-white">
        <script>
            // Immediately invoked function to set the theme
            (function() {
                try {
                    const savedTheme = localStorage.getItem('theme');
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    const isLight = savedTheme === 'light' || (!savedTheme && !prefersDark); // Default to Dark
                    
                    if (isLight) {
                        document.body.classList.add('light-theme');
                    } else {
                        document.body.classList.remove('light-theme');
                    }
                } catch (e) {
                    console.error('Theme initialization failed:', e);
                }
            })();
        </script>
        {% if '/blog/' in page.url %}
        <div id="scroll-progress-container" class="fixed top-0 left-0 w-full h-1 z-[100] bg-transparent">
            <div id="scroll-progress-bar" class="h-full bg-accent-primary transition-all duration-150 ease-out" style="width: 0%;"></div>
        </div>
        {% endif %}
        <!-- Header & Nav -->
        <header class="fixed w-full top-0 z-50 glass-card">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <a href="/" class="text-3xl font-extrabold tracking-tight logo-text group">
                    {{ site.author.shortname }}<span class="accent-primary group-hover:animate-pulse">.</span>
                </a>
                
                <div class="hidden md:flex space-x-8 items-center">
                    <a href="/about" class="text-sm font-medium nav-link" data-text="About">About</a>
                    <a href="/blog" class="text-sm font-medium nav-link" data-text="Blog">Blog</a>
                    <a href="/experience" class="text-sm font-medium nav-link" data-text="Experience">Experience</a>
                    <a href="/#skills" class="text-sm font-medium nav-link" data-text="Skills">Skills</a>
                    <a href="/#contact" class="text-sm font-medium nav-link" data-text="Contact">Contact</a>
                    <a href="/resume" class="btn text-sm py-2 px-6">Resume</a>
                </div>

                <div class="flex items-center space-x-4">
                    <button id="theme-toggle" class="text-gray-400 hover:text-accent-primary p-2 rounded-lg transition-colors" aria-label="Toggle theme">
                        <i id="theme-toggle-icon" class="fa-solid fa-moon text-xl"></i>
                    </button>
                    <div class="md:hidden">
                        <button id="mobile-menu-button" class="logo-text p-2 rounded-lg hover:bg-white/10 transition-colors" aria-label="Toggle mobile menu">
                            <i class="fa-solid fa-bars text-xl" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden px-6 py-8 space-y-6">
                <a href="/about" class="block text-xl font-medium nav-link" data-text="About">About</a>
                <a href="/blog" class="block text-xl font-medium nav-link" data-text="Blog">Blog</a>
                <a href="/experience" class="block text-xl font-medium nav-link" data-text="Experience">Experience</a>
                <a href="/#skills" class="block text-xl font-medium nav-link" data-text="Skills">Skills</a>
                <a href="/#contact" class="block text-xl font-medium nav-link" data-text="Contact">Contact</a>
                <div class="pt-4">
                    <a href="/resume" class="btn w-full block">View Resume</a>
                </div>
            </div>
        </header>
        <main class="main-content container mx-auto px-6 md:px-10 lg:px-20 pt-32 pb-12">
            {{ content | safe }}
        </main>
        <!-- Scroll to Top Button -->
        <button id="scroll-to-top" class="fixed bottom-8 right-8 z-[60] w-12 h-12 rounded-full shadow-lg backdrop-blur-sm opacity-0 translate-y-12 transition-all duration-300 pointer-events-none flex items-center justify-center border border-white/10" aria-label="Scroll to top">
            <i class="fa-solid fa-arrow-up"></i>
        </button>

        <!-- Footer -->
        <footer style="background-color: var(--footer-bg); color: var(--footer-text);" class="py-12 transition-colors">
            <div class="container mx-auto px-6 text-center">
                <div class="flex justify-center space-x-6 mb-8">
                    <a href="{{ site.author.linkedinUrl }}" target="_blank" class="hover:text-accent-primary transition-colors" aria-label="LinkedIn profile of {{ site.author.name }}"><i class="fa-brands fa-linkedin fa-2xl" aria-hidden="true"></i></a>
                    <a href="mailto:{{ site.author.email }}" class="hover:text-accent-primary transition-colors" aria-label="Email {{ site.author.name }}"><i class="fa-solid fa-envelope fa-2xl" aria-hidden="true"></i></a>
                    <a href="{{ site.author.githubUrl }}" target="_blank" class="hover:text-accent-primary transition-colors" aria-label="GitHub profile of {{ site.author.name }}"><i class="fa-brands fa-github fa-2xl" aria-hidden="true"></i></a>
                    <a href="{{ site.source }}" target="_blank" class="hover:text-accent-primary transition-colors" aria-label="Website source code"><i class="fa-solid fa-code fa-2xl" aria-hidden="true"></i></a>
                    <a href="/feed.xml" class="hover:text-accent-primary transition-colors" aria-label="RSS Feed"><i class="fa-solid fa-rss fa-2xl" aria-hidden="true"></i></a>
                </div>
                <p>&copy; {% year %} {{ site.author.name }}. All Rights Reserved.</p>
            </div>
        </footer>
        <script src="/js/main.js"></script>
        <!-- Mermaid for technical diagrams -->
        <script type="module">
            import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ 
                startOnLoad: true,
                theme: document.body.classList.contains('light-theme') ? 'default' : 'dark',
                securityLevel: 'loose',
                fontFamily: 'IBM Plex Sans, sans-serif'
            });
        </script>
        {% if page.url == "/" %}
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // Define a unique slug for the home page
                const slug = 'homepage';
                
                // Use a flag in localStorage to prevent incrementing on every refresh
                const viewed = localStorage.getItem(`viewed-${slug}`);

                if (!viewed) {
                    // We only need to send the update, not get the result
                    fetch(`/api/views/${slug}`, { method: 'POST' })
                        .then(response => {
                            if (response.ok) {
                                // Mark as viewed in this session if the update was successful
                                localStorage.setItem(`viewed-${slug}`, 'true');
                            }
                        })
                        .catch(error => {
                            console.error('Error updating home page view count:', error);
                        });
                }
            });
        </script>
        {% endif %}
    </body>
</html>
